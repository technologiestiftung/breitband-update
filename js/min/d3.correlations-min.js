function d3_correlation(t){function r(t){n=t,l.domain([0,p.length]),f=(a-2*o)/p.length,r.init()}function e(t,r){var e=function(t,r){return t+r},n=1*t.reduce(e)/t.length,a=1*r.reduce(e)/r.length,i=t.map(function(t){return Math.pow(t-n,2)}).reduce(e),o=r.map(function(t){return Math.pow(t-a,2)}).reduce(e),u=t.map(function(t,e){return(t-n)*(r[e]-a)}).reduce(e),p=u/i;return[p,a-n*p,Math.pow(u,2)/(i*o)]}var n,a=300,i=100,o=10,u,p=t,c=[{r:189,g:0,b:38,a:.8},{r:240,g:59,b:32,a:.8},{r:253,g:141,b:60,a:.8},{r:254,g:204,b:92,a:.8},{r:255,g:255,b:178,a:.8}],d=[100,95,75,50,10],s=d3.scale.linear().domain(d).range(c),l=d3.scale.linear().range([0,a-2*o]),f,h=i-2*o,g=d3.scale.linear().domain(d).range([h,.95*h,.75*h,.5*h,.1*h]);return r.init=function(){n.each(function(){var t=d3.select(this);u=t.append("svg").attr("viewBox","0 0 "+a+" "+i).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform","translate("+o+","+o+")");var e=t.attr("data-speed"),n=t.attr("data-type"),c=p.sort(function(t,r){return t.properties[n]==r.properties[n]?t.properties[e]-r.properties[e]:t.properties[n]-r.properties[n]});u.selectAll("rect").data(c).enter().append("rect").style("stroke","transparent").style("fill",function(t){var r=s(t.properties[e]);return"rgb("+Math.round(r.r)+","+Math.round(r.g)+","+Math.round(r.b)+")"}).attr("x",function(t,r){return l(r)}).attr("width",f).attr("height",function(t){return g(t.properties[e])}).attr("y",function(t){return i-2*o-g(t.properties[e])}),"dist"==n||"population"==n?r.trendline(c,e,u,0,c.length-1):[0,1,2].forEach(function(t){var a=[],i=!1,o=0;c.forEach(function(r,e){r.properties[n]==t&&(a.push(r),o<e&&(o=e),i||(i=e))}),r.trendline(a,e,u,i,o)})}),r.resize()},r.trendline=function(t,r,n,a,o){var u=d3.range(1,t.length+1),c=p.map(function(t){return parseFloat(t.properties[r])}),d=e(u,c),s=a,f=d[0]+d[1],h=o,v=d[0]*u.length+d[1],m=[s,f,h,v],b=n.append("line").datum(m).attr("class","trendline").attr("x1",function(t){return l(t[0])}).attr("y1",function(t){return i-g(t[1])}).attr("x2",function(t){return l(t[2])}).attr("y2",function(t){return i-g(t[3])}).attr("stroke","black").attr("stroke-width",1)},r.resize=function(){var t=d3.select(".correlation"),r=t.node().getBoundingClientRect();a=r.width,i=a/3,u.style("height",i+"px")},r}