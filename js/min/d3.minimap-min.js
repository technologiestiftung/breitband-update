function d3_minimap(){function t(i){e=i,d3.json("data/berlin_bezirke.topojson",function(e,i){n=i,t.init()});var u=d3.select("#minimap-legend"),l=d3.scale.linear().domain(c).range([199,150,100,50,0]),o=d3.svg.axis().scale(l).orient("top").tickValues(c).tickFormat(function(t,e){return t+"%"});u.append("g").attr("class","x axis").attr("transform","translate(20,33)").call(o),u.append("defs").append("linearGradient").attr("id","gradient").attr("x1","100%").attr("y1","0%").attr("x2","0%").attr("y2","0%").attr("spreadMethod","pad").selectAll("stop").data(a).enter().append("stop").attr("offset",function(t,e){return 100/a.length*e+"%"}).attr("stop-color",function(t){return"rgb("+t.r+","+t.g+","+t.b+")"}).attr("stop-opacity",1),u.append("rect").attr("x",20).attr("y",30).attr("width",200).attr("height",20).style("stroke","#000").style("stroke-width",.5).style("fill","url(#gradient)")}var e,n,i={"Charlottenburg-Wilmersdorf":{2011:{leitung16:683,leitung50:614,count:7},2012:{leitung16:689,leitung50:630,count:7},2013:{leitung16:693,leitung50:668,count:7},2015:{leitung16:695,leitung50:670,count:7},2017:{leitung16:5619,leitung50:5333,count:57}},"Friedrichshain-Kreuzberg":{2011:{leitung16:184,leitung50:149,count:2},2012:{leitung16:194,leitung50:162,count:2},2013:{leitung16:195,leitung50:163,count:2},2015:{leitung16:198,leitung50:177,count:2},2017:{leitung16:2570,leitung50:2358,count:26}},Lichtenberg:{2011:{leitung16:853,leitung50:665,count:10},2012:{leitung16:901,leitung50:747,count:10},2013:{leitung16:892,leitung50:690,count:10},2015:{leitung16:934,leitung50:764,count:10},2017:{leitung16:3071,leitung50:2627,count:32}},"Marzahn-Hellersdorf":{2011:{leitung16:469,leitung50:336,count:5},2012:{leitung16:477,leitung50:361,count:5},2013:{leitung16:487,leitung50:397,count:5},2015:{leitung16:492,leitung50:418,count:5},2017:{leitung16:3238,leitung50:2880,count:33}},Mitte:{2011:{leitung16:579,leitung50:524,count:6},2012:{leitung16:588,leitung50:537,count:6},2013:{leitung16:594,leitung50:560,count:6},2015:{leitung16:600,leitung50:565,count:6},2017:{leitung16:4066,leitung50:3860,count:41}},"Neukölln":{2011:{leitung16:474,leitung50:394,count:5},2012:{leitung16:483,leitung50:404,count:5},2013:{leitung16:489,leitung50:432,count:5},2015:{leitung16:496,leitung50:433,count:5},2017:{leitung16:3962,leitung50:3535,count:40}},Pankow:{2011:{leitung16:1060,leitung50:682,count:13},2012:{leitung16:1076,leitung50:731,count:13},2013:{leitung16:1123,leitung50:831,count:13},2015:{leitung16:1197,leitung50:929,count:13},2017:{leitung16:3797,leitung50:3420,count:40}},Reinickendorf:{2011:{leitung16:963,leitung50:761,count:10},2012:{leitung16:973,leitung50:764,count:10},2013:{leitung16:987,leitung50:853,count:10},2015:{leitung16:997,leitung50:897,count:10},2017:{leitung16:2964,leitung50:2707,count:30}},Spandau:{2011:{leitung16:809,leitung50:668,count:9},2012:{leitung16:818,leitung50:702,count:9},2013:{leitung16:846,leitung50:780,count:9},2015:{leitung16:862,leitung50:792,count:9},2017:{leitung16:3771,leitung50:3381,count:39}},"Steglitz-Zehlendorf":{2011:{leitung16:670,leitung50:540,count:7},2012:{leitung16:674,leitung50:548,count:7},2013:{leitung16:687,leitung50:624,count:7},2015:{leitung16:694,leitung50:627,count:7},2017:{leitung16:4067,leitung50:3731,count:41}},"Tempelhof-Schöneberg":{2011:{leitung16:584,leitung50:511,count:6},2012:{leitung16:589,leitung50:520,count:6},2013:{leitung16:590,leitung50:554,count:6},2015:{leitung16:598,leitung50:557,count:6},2017:{leitung16:3369,leitung50:3105,count:34}},"Treptow-Köpenick":{2011:{leitung16:1394,leitung50:912,count:15},2012:{leitung16:1395,leitung50:964,count:15},2013:{leitung16:1446,leitung50:1220,count:15},2015:{leitung16:1463,leitung50:1236,count:15},2017:{leitung16:3302,leitung50:2821,count:34}}},u=16,l=300,o=300,g=d3.geo.mercator().scale(2e4).precision(.1).center([13.403528,52.540212]).translate([150,150]),r=d3.geo.path().projection(g),a=[{r:189,g:0,b:38,a:.8},{r:240,g:59,b:32,a:.8},{r:253,g:141,b:60,a:.8},{r:254,g:204,b:92,a:.8},{r:255,g:255,b:178,a:.8}],c=[100,95,75,50,10],s=d3.scale.linear().domain(c).range(a);return t.init=function(){e.each(function(){var t=d3.select(this);t.selectAll("*").remove();var e=t.append("svg").attr("viewBox","0 0 300 300").attr("preserveAspectRatio","xMidYMid meet"),l=t.attr("data-year");e.selectAll("path").data(topojson.feature(n,n.objects.berlin_bezirke).features).enter().append("path").attr("d",function(t){return r(t)}).attr("data-year",l).on("mouseover",function(){var t=d3.select(this),e=t.data()[0],n=t.node().getBoundingClientRect();"de"==lang?tooltip.content("<strong>"+e.properties.name+"</strong><br />Netz mit einer Geschwindigkeit von<br /> bis zu "+u+" Mbit/s ist zu "+(i[e.properties.name][l]["leitung"+u]/i[e.properties.name][l].count).toFixed(2)+"% verfügbar."):tooltip.content("<strong>"+e.properties.name+"</strong><br />Connections with speeds<br /> of up to "+u+" Mbit/s are "+(i[e.properties.name][l]["leitung"+u]/i[e.properties.name][l].count).toFixed(2)+"% available."),tooltip.position([n.left+window.pageXOffset+n.width/2,n.top+window.pageYOffset+n.height/2]),tooltip.show()}).on("mouseout",function(){tooltip.hide()}),e.append("text").text(l).attr("x",150).attr("y",280).attr("text-anchor","middle")}),d3.selectAll(".switchrow .col").on("click",function(){var e=d3.select(this);d3.selectAll(".switchrow .col .triangle").style("display","none"),e.select(".triangle").style("display","block"),d3.selectAll(".mapswitch").attr("class","mapswitch light_red"),e.select(".mapswitch").attr("class","mapswitch red"),d3.selectAll(".speed-info").style("display","none"),d3.selectAll(".speed-info-"+e.attr("data-speed")).style("display","block"),t.switchSpeed(e.attr("data-speed"))}),t.updateColor(),t.resize()},t.updateColor=function(){e.each(function(){var t=d3.select(this),e=t.attr("data-year");t.selectAll("path").data(topojson.feature(n,n.objects.berlin_bezirke).features).style("fill",function(t){var n=s(i[t.properties.name][e]["leitung"+u]/i[t.properties.name][e].count);return"rgb("+Math.round(n.r)+","+Math.round(n.g)+","+Math.round(n.b)+")"})})},t.switchSpeed=function(e){u=e,t.updateColor()},t.resize=function(){var t=d3.select(".minimap"),n=t.node().getBoundingClientRect(),i=n.width;e.style("height",i+"px")},t}