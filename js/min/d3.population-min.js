function d3_population(t){function e(t){r=t,u.forEach(function(t){t.properties.bez in p||(p[t.properties.bez]={16:0,50:0,100:0}),p[t.properties.bez][16]+=t.properties.population*((100-t.properties["p-all-16_mbit"])/100),p[t.properties.bez][50]+=t.properties.population*((100-t.properties["p-all-50_mbit"])/100),p[t.properties.bez][100]+=t.properties.population*((100-t.properties["p-all-100_mbit"])/100)});for(var n in p){for(var a in p[n])p[n][a]=Math.round(p[n][a]);s.push({name:n,speed:p[n],sort:{}}),d[n]=s.length-1}var c=JSON.parse(JSON.stringify(s));["16","50","100"].forEach(function(t){c.sort(function(e,n){return n.speed[t]-e.speed[t]}),c.forEach(function(e,n){s[d[e.name]].sort[t]=n})}),l=r.append("svg").attr("width","100%").attr("height",2*o+(o+i)*s.length).append("g").attr("transform","translate(20,20)"),g.domain([0,d3.max(s,function(t){return d3.max([t.speed[16],t.speed[50],t.speed[100]])})]),e.init()}function n(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}var r,a="16",i=20,o=20,p={},s=[],d={},u=t,c,l,f,h,g=d3.scale.linear();return e.init=function(){f=l.selectAll("g").data(s).enter().append("g"),f.append("text").text(function(t){return t.name}).style("text-anchor","end").style("font-size",12).attr("dy",14).attr("transform","translate(170,0)"),c=f.append("text").text(function(t){return n(t.speed[a])}).style("font-size",12).attr("dy",14),h=f.append("rect").attr("transform","translate(180,0)").attr("height",i),d3.selectAll(".population-button").on("click",function(){e.switch(d3.select(this).attr("data-key"))}),e.resize()},e.resize=function(){var t=r.node().getBoundingClientRect();width=t.width,g.range([0,width-3*o-170-30]),e.update()},e.update=function(){f.data(s).transition().duration(300).attr("transform",function(t){return"translate(0, "+t.sort[a]*(i+10)+")"}),h.transition().duration(300).attr("width",function(t){return g(t.speed[a])}),c.text(function(t){return n(t.speed[a])}).transition().duration(300).attr("transform",function(t){return"translate("+(g(t.speed[a])+20+170)+",0)"})},e.switch=function(t){a=t,e.update()},e}